<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE MudletPackage>
<MudletPackage version="1.001">
	<ScriptPackage>
		<ScriptGroup isActive="yes" isFolder="yes">
			<name>zData</name>
			<packageName></packageName>
			<script>-------------------------------------------------
--                                             --
--       Zulah's Hunting Database: zData       --
--            Last Update: 3/17/22             --
--                                             --
-------------------------------------------------
--                                             --
--                    Setup                    --
--                                             --
-------------------------------------------------
zData = zData or {}

zData.bardName = "Jaskier"
zData.bardVoice = " with a melodic voice"

function zData.echo(text)
	hecho(rainbow("\n"..zData.bardName..", appears strumming his lute to a tune of your greatness.\nEager to record your recent hunt in lavish detail and song, "..zData.bardName.." frantically works his quill."))
  cecho("\n\n&lt;gold&gt;"..zData.bardName.."&lt;cyan&gt; says to you"..zData.bardVoice..", \"Quite the slaughter you had at "..text.."\"\n\n")
end

zData.deleteAble = false

createStopWatch("zoneHuntWatch")
stopStopWatch("zoneHuntWatch")
resetStopWatch("zoneHuntWatch")

zData.db = zData.db or {}

zData.defs = zData.defs or {}

zData.char = zData.char or {}
zData.char = {
  lastArea = "NA", 
  
  tempTime = 0,
  minuteTime = 0,
  xpGains = 0,
  xpGainsMin = 0,
  killsPerMinute = 0, 
  
  totalAttacks = 0,
  crithits = 0,
  crit1 = 0,
  crit2 = 0,
  crit3 = 0,
  crit4 = 0,
  crit5 = 0,
  crit6 = 0,
  searedglyph = 0,
  shield = 0,
  paragon = 0,
  mayafigure = 0,
  
  ogold = 0,         -- old gold
  gold = 0,
  gpm = 0,          -- gold per minute
  
 	xp = 0,
  oxp = 0,       --old xp
  
  str = 0,
  dex = 0,
  int = 0,
  con = 0,
  
  killsCount = 0,
  killList = {},
  
  taliCount = 0,
  taliList = {},
  
  when = 0,
}

zData.classList =  {                                                       -- List of classes for searching the database by class
  ["alchemist"] = {["int"] = zData.char.int,},
  ["apostate"] = {["int"] = zData.char.int,},
  ["bard"] = {["str"] = zData.char.str,},
  ["blademaster"] = {["str"] = zData.char.str,},
  ["depthswalker"] = {["str"] = zData.char.str,},
  ["druid"] = {["str"] = zData.char.str,},
  ["infernal"] = {["str"] = zData.char.str,},
  ["jester"] = {["str"] = zData.char.str,},
  ["magi"] = {["int"] = zData.char.int,},
  ["monk"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["occultist"] = {["int"] = zData.char.int,},
  ["paladin"] = {["str"] = zData.char.str,},
  ["pariah"] = {["int"] = zData.char.int,},
  ["priest"] = {["int"] = zData.char.int,},
  ["psion"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["runewarden"] = {["str"] = zData.char.str,},
  ["sentinel"] = {["str"] = zData.char.str,},
  ["serpent"] = {["dex"] = zData.char.dex,},
  ["shaman"] = {["int"] = zData.char.int,},
  ["sylvan"] = {["int"] = zData.char.int,},
  ["unnamable"] = {["str"] = zData.char.str,},
  ["red dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["blue dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["gold dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["silver dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["green dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["black dragon"] = {["str"] = zData.char.str,["int"] = zData.char.int,},
  ["dragon"] = "na",
  ["elemental"] = "na",                                                         
}</script>
			<eventHandlerList />
			<Script isActive="yes" isFolder="no">
				<name>Experience Database</name>
				<packageName></packageName>
				<script>-------------------------------------------------
--                                             --
--                    Setup                    --
--                                             --
-------------------------------------------------
db:create("exp_db", 
  {
    zones={             
      "area",
      "class",
      "boost",
      "critpercent",
      "time",
      "epm",
      "exp",
      "kill",
      "kpm",
      "gold",
      "gpm",
      "str",
      "dex",
      "int",
      "con",  
      "attacks",
      "crits","crits1","crits2","crits3","crits4","crits5","crits6",
      "soa",
      "soaparagon",
      "glyph",
      "maya",
      "tali",
      "killlist",
      "talilist",
      "when",
      },
  })                                                 -- This creates database exp_db (if not already)
zData.db.expdb = db:get_database("exp_db")           -- This assigns the database name to a variable for ease of use purposes.
 
-------------------------------------------------
--                                             --
--  Add a new records: zData.db.zoneAdd(stuff) --
--                                             --
-------------------------------------------------
function zData.db.zoneAdd(area, class, boost, critpercent, time, epm, exp, kill, kpm, gold, gpm, str, dex, int, con, attacks, crits, crits1, crits2, crits3, crits4, crits5, crits6, soa, soaparagon, glyph, maya, tali, killlist, talilist, when)
  db:add(zData.db.expdb.zones,{
    area=area, class=class, boost=boost, critpercent=critpercent, 
    time=time, epm=epm, exp=exp, kill=kill, kpm=kpm, gold=gold, gpm=gpm, 
    str=str, dex=dex, int=int, con=con, 
    attacks=attacks, crits=crits, crits1=crits1, crits2=crits2, crits3=crits3, crits4=crits4, crits5=crits5, crits6=crits6, 
    soa=soa, soaparagon=soaparagon, glyph=glyph, maya=maya, 
    tali=tali, 
    killlist=killlist, 
    talilist=talilist,
    when=when})
  zData.echo("&lt;magenta&gt;"..area.."&lt;cyan&gt;\! &lt;NavajoWhite&gt;"..string.cut(exp,5).."&lt;cyan&gt; experience. &lt;NavajoWhite&gt;"..string.cut(kpm,4).."&lt;cyan&gt; KPM!")
end

-------------------------------------------------
--                                             --
--  Simple Add +1 : zData.db.addChar(addThis)  --
--                                             --
-------------------------------------------------
function zData.db.addChar(addThis)
  zData.char[addThis] = zData.char[addThis] + 1
end

------------------------------------------------------------
--                                                        --
-- Sort Database: zData.db.showData(sortWith, sortStyle)  --
--                                                        --
-- sortWith = Class / all / area search                   --
-- sortStyle = exp / epm / kill / kpm                     --
--                                                        --
------------------------------------------------------------
function zData.db.showData(sortWith, sortStyle, sortDirection)           -- This is my spaghetti code function 
  if zData.hunter then
    zData.hunter.window:show()
  else
    zData.buildHunter()
  end
  zData.db.localDB = {}                                   -- This is the table for sorting and display database results
  local maxShow = 40                     ------&lt;--&lt;--&lt;--&lt;--&lt; Max number of results to show unless ALL is used. Increase to see more (Over 200 will not allow deleting)
  local titleColor = "gold" 
  local menuColor = "purple" 
  local areaColor = "ansiMagenta"
  local classColor = "purple"
  local taliColor = "ansiMagenta"
  local timeColor = "ansiMagenta"
  
  local critColor = "ansiMagenta"
  
  local killColor = "ansiMagenta"
  local kpmColor = "ansiMagenta"
  local expColor = "ansiMagenta"
  local epmColor = "ansiMagenta"
  local gpmColor = "ansiMagenta"
  local goldColor = "ansiMagenta"
  local showCount = 0  

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- Show Rows Based on Sorting  
  local function showCharts(thisChart, thisRow)
    if sortDirection and sortDirection == "down" then
      for _, row in spairs(zData.db.localDB) do
        if row[thisChart] == "" then
          row[thisChart] = 0
        end
      end
    
      for _, row in spairs(zData.db.localDB, function(t,a,b) return tonumber(t[a][thisChart]) &lt; tonumber(t[b][thisChart]) end) do    
-------------------------- Limit results to MAXSHOW        
        if sortWith and string.lower(sortWith) == "all" then 
          zData.deleteAble = false
        else 
          if maxShow &lt; 240 then zData.deleteAble = true end
          showCount = showCount + 1
          if showCount &gt;= maxShow then break end      
        end
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else 
          if thisChart == "tali" then
            taliColor = "gold" 
          else
            taliColor = "ansiMagenta" 
          end
        end    
--------------------------- Blackout 0 crit counts     
        if thisChart == "critpercent" then   
          if tonumber(row.critpercent) &lt; 1 then 
            critColor = "black:black"
          else  
            critColor = "gold"
          end         
        end    
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "\n  &lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)

          .. "  &lt;"..critColor.."&gt;"..string.cut(string.cut(row.critpercent, 4).."     ", 5)  

          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    else
      for _, row in spairs(zData.db.localDB) do
        if row[thisChart] == "" then
          row[thisChart] = 0
        end
      end
          
      for _, row in spairs(zData.db.localDB, function(t,a,b) return tonumber(t[a][thisChart]) &gt; tonumber(t[b][thisChart]) end) do    
-------------------------- Limit results to MAXSHOW        
        if sortWith and string.lower(sortWith) == "all" then 
          zData.deleteAble = false
        else 
          if maxShow &lt; 240 then zData.deleteAble = true end
          showCount = showCount + 1
          if showCount &gt;= maxShow then break end      
        end
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else 
          if thisChart == "tali" then
            taliColor = "gold" 
          else
            taliColor = "ansiMagenta"
          end
        end    
--------------------------- Blackout 0 crit counts     
        if thisChart == "critpercent" then   
          if tonumber(row.critpercent) &lt; 1 then 
            critColor = "black:black"
          else  
            critColor = "gold"
          end         
        end    
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "\n  &lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)

          .. "  &lt;"..critColor.."&gt;"..string.cut(string.cut(row.critpercent, 4).."     ", 5)          
          
          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    end
  end --- End of local function showCharts()
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

--------------------------- Show Last 3 Zones
  local function showLast(thisChart, countBack)
    showCount = 0  
    local useRow = tonumber(#zData.db.localDB) - countBack
    for _, row in spairs(zData.db.localDB) do               
      if _ == useRow then
-------------------------- Limit results to 1        
        showCount = showCount + 1
        if showCount &gt;= 2 then break end          
--------------------------- Blackout 0 talisman counts        
        if tonumber(row.tali) &lt; 1 then taliColor = "black:black" else taliColor = "ansiMagenta" end
--------------------------- Display Each Row From The Database, Clickable For More Information
        cechoLink("hunterDisplay", 
          "&lt;"..areaColor.."&gt;"..string.cut(row.area.."                   ", 20)
          .." &lt;"..classColor.."&gt;"..string.cut(row.class.."            ", 13)
          .. " &lt;"..taliColor.."&gt;"..string.cut(string.cut(row.tali,2).."   ", 4)
          .. " &lt;"..timeColor.."&gt;"..string.cut(string.cut((row.time/60), 4).."      ", 6)
          .. "  &lt;"..critColor.."&gt;"..string.cut(string.cut(row.critpercent, 4).."     ", 5)         
          .. " &lt;"..killColor.."&gt;"..string.cut(string.cut(row.kill,4).."     ", 6)
          ..  " &lt;"..kpmColor.."&gt;"..string.cut(string.cut(row.kpm,4).."     ", 6)
          ..  " &lt;"..expColor.."&gt;"..string.cut(string.cut(row.exp,4).."     ", 6)
          ..  " &lt;"..epmColor.."&gt;"..string.cut(string.cut(row.epm,5).."      ", 7)
          ..  " &lt;"..gpmColor.."&gt;"..string.cut(string.cut(math.floor(row.gpm),6).."       ", 8) 
          .. " &lt;"..goldColor.."&gt;"..string.cut(row.gold .."      ", 7),
        ---------------------------------------------------------------------------------  
          [[zData.db.clickback(]].._..[[)]], [[]], true)                               -- What to do when clicked on
        --------------------------------------------------------------------------------- 
      end --- End of for _,row
    end
  end --- End of local function showCharts()
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
  
-------------------------- Search For sortWith (First level sort: class name / all / area random
  if sortWith then
    if string.lower(sortWith) == "all" or
       string.lower(sortWith) == "tali" or
       string.lower(sortWith) == "time" or
       
       string.lower(sortWith) == "critpercent" or
       
       string.lower(sortWith) == "kill" or 
       string.lower(sortWith) == "kpm" or
       string.lower(sortWith) == "exp" or
       string.lower(sortWith) == "epm" or
       string.lower(sortWith) == "gold" or
       string.lower(sortWith) == "gpm"
     then
      zData.db.localDB = db:fetch(zData.db.expdb.zones)
    elseif table.contains(zData.classList, string.lower(sortWith)) then
      zData.db.localDB = db:fetch(zData.db.expdb.zones, db:like(zData.db.expdb.zones.class,"%"..sortWith.."%")) 
    else
	    zData.db.localDB = db:fetch(zData.db.expdb.zones, db:like(zData.db.expdb.zones.area,"%"..sortWith.."%")) 
    end   
  else
    zData.db.localDB = db:fetch(zData.db.expdb.zones)
  end
  
-------------------------- Clear Display   
  clearWindow("hunterDisplay") 
-------------------------- Display NO Results
  if #zData.db.localDB == 0 then
    cecho("hunterDisplay", "\n\n&lt;red&gt;     Nothing Found Searching &lt;gold&gt;Zones&lt;red&gt; for the string: &lt;gold&gt;"..sortWith.."\n       &lt;green&gt;Try Typing: &lt;gold&gt;zbash "..string.lower(gmcp.Char.Status.class).."\n")
-------------------------- Display Results
  else
    cecho("hunterDisplay", "\n                                   &lt;"..titleColor.."&gt;Detailed Hunting Scrolls\n")
-------------------------- Display Last 3 Zones
  hecho("hunterDisplay", rainbow("@@#################################################################################################@@"))    
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;1:")
    showLast("when", 0)
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;2:")
    showLast("when", 1)
  cecho("hunterDisplay", "\n&lt;"..titleColor.."&gt;3:")
    showLast("when", 2)
  cecho("hunterDisplay", "\n")
  hecho("hunterDisplay", rainbow("@@#################################################################################################@@\n"))
-------------------------- Display
    cecho("hunterDisplay","&lt;"..menuColor.."&gt;                                ")
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Tali", [[zData.db.showData("tali")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Time", [[zData.db.showData("time")]], [[]], true)

    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Crit", [[zData.db.showData("critpercent")]], [[]], true)

    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Kill", [[zData.db.showData("kill")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;KPM", [[zData.db.showData("kpm")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;Exp", [[zData.db.showData("exp")]], [[]], true)
    cechoLink("hunterDisplay","     &lt;"..menuColor.."&gt;EPM", [[zData.db.showData("epm")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;GPM", [[zData.db.showData("gpm")]], [[]], true)
    cechoLink("hunterDisplay","      &lt;"..menuColor.."&gt;Gold", [[zData.db.showData("gold")]], [[]], true) 
-------------------------- Display Results based on search(sortStyle)    
    if (sortStyle and string.lower(sortStyle) == "all") or (sortWith and string.lower(sortWith) == "all") then
      showCharts("exp", "expColor") 
    elseif (sortStyle and string.lower(sortStyle) == "exp") or (sortWith and string.lower(sortWith) == "exp") then
      expColor = "gold"
      showCharts("exp", "expColor")  
    elseif (sortStyle and string.lower(sortStyle) == "epm") or (sortWith and string.lower(sortWith) == "epm") then
      epmColor = "gold"
      showCharts("epm", "epmColor")  
    elseif (sortStyle and string.lower(sortStyle) == "time") or (sortWith and string.lower(sortWith) == "time") then
      timeColor = "gold"
      showCharts("time", "timeColor")  

    elseif (sortStyle and string.lower(sortStyle) == "critpercent") or (sortWith and string.lower(sortWith) == "critpercent") then
      critColor = "gold"
      showCharts("critpercent", "critColor")  

    elseif (sortStyle and string.lower(sortStyle) == "tali") or (sortWith and string.lower(sortWith) == "tali") then
      taliColor = "gold"
      showCharts("tali", "taliColor")    
    elseif (sortStyle and string.lower(sortStyle) == "gpm") or (sortWith and string.lower(sortWith) == "gpm") then
      gpmColor = "gold"
      showCharts("gpm", "gpmColor") 
    elseif (sortStyle and string.lower(sortStyle) == "gold") or (sortWith and string.lower(sortWith) == "gold") then
      goldColor = "gold"
      showCharts("gold", "goldColor")  
    elseif (sortStyle and string.lower(sortStyle) == "kill") or (sortWith and string.lower(sortWith) == "kill") then
      killColor = "gold"
      showCharts("kill", "killColor")  
    elseif (sortStyle and string.lower(sortStyle) == "kpm") or (sortWith and string.lower(sortWith) == "kpm") then
      kpmColor = "gold"
      showCharts("kpm", "kpmColor")  
    else
      kpmColor = "gold"
      showCharts("kpm", "kpmColor")
    end  
    cecho("hunterDisplay","\n&lt;"..menuColor.."&gt;                                ")
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Tali", [[zData.db.showData("tali", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Time", [[zData.db.showData("time", nil, "down")]], [[]], true)

    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Crit", [[zData.db.showData("critpercent", nil, "down")]], [[]], true)

    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;Kill", [[zData.db.showData("kill", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","   &lt;"..menuColor.."&gt;KPM", [[zData.db.showData("kpm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;Exp", [[zData.db.showData("exp", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","     &lt;"..menuColor.."&gt;EPM", [[zData.db.showData("epm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","    &lt;"..menuColor.."&gt;GPM", [[zData.db.showData("gpm", nil, "down")]], [[]], true)
    cechoLink("hunterDisplay","      &lt;"..menuColor.."&gt;Gold", [[zData.db.showData("gold", nil, "down")]], [[]], true)  
  end
-------------------------- Display Footer     
  hecho("hunterDisplay", rainbow("\n@@#################################################################################################@@\n"))  
end 


-------------------------------------------------
--                                             --
--  View a saved record: zData.db.clickback()  --
--                                             --
-------------------------------------------------
function zData.db.clickback(thisRow)
  local deleteRow = 0
-------------------------- Clear Display   
  clearWindow("hunterDisplay") 
-------------------------- DELETE DATABASE ENTRY ---------------------------
  if zData.deleteAble then
    for _, row in spairs(zData.db.localDB) do
      if _ == thisRow then
        deleteRow = _
      end
    end
    cechoLink("hunterDisplay","\n&lt;red&gt;  --@@ DELETE ENTRY @@--  ", [[zData.db.clickbackdelete(]]..thisRow..[[)]], [[Clicking here will PERMENENTLY DELETE this entry]], true)
  end
----------------------------------------------------------------------------
  hecho("hunterDisplay", rainbow("\n@@#################################################################################################@@\n")) 
-------------------------- Display Header ^
  cecho("hunterDisplay","\n  &lt;purple&gt;Extended Report For: &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].class.."                                        ",40).."&lt;purple&gt;Date: &lt;gold&gt;"..zData.db.localDB[thisRow].when)
  cecho("hunterDisplay","\n  &lt;purple&gt;Hunting in the Zone: &lt;gold&gt;"..zData.db.localDB[thisRow].area)
  cecho("hunterDisplay","\n  &lt;purple&gt;Time Spent: &lt;ansiMagenta&gt;"..string.cut((zData.db.localDB[thisRow].time/60),4).." minutes")
  cecho("hunterDisplay","\n  &lt;purple&gt;Experience: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].exp)
  cecho("hunterDisplay","\n  &lt;purple&gt;Experience Modifier: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].boost.."\%\n")
  cecho("hunterDisplay","\n  &lt;purple&gt;Stats: &lt;ansiMagenta&gt;Str: &lt;gold&gt;"..zData.db.localDB[thisRow].str.." &lt;ansiMagenta&gt;Dex: &lt;gold&gt;"..zData.db.localDB[thisRow].dex.." &lt;ansiMagenta&gt;Int: &lt;gold&gt;"..zData.db.localDB[thisRow].int.." &lt;ansiMagenta&gt;Con: &lt;gold&gt;"..zData.db.localDB[thisRow].con.."\n")
  cecho("hunterDisplay","\n     &lt;purple&gt;Critical Hit Chance: &lt;ansiMagenta&gt;"..zData.db.localDB[thisRow].critpercent.."\%")
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].crits.."  &lt;purple&gt;Critical Hits")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits1.."  ",3).." &lt;ansiMagenta&gt; 2x "..string.cut("Critical                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].glyph.."  &lt;ansiMagenta&gt;Seared Glyph")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits2.."  ",3).." &lt;ansiMagenta&gt; 4x "..string.cut("Crushing                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].soa.."  &lt;ansiMagenta&gt;Shield of Absorption")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits3.."  ",3).." &lt;ansiMagenta&gt; 8x "..string.cut("Obliterating                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].soaparagon.."  &lt;ansiMagenta&gt;SoA Paragon")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits4.."  ",3).." &lt;ansiMagenta&gt;16x "..string.cut("Annihilating                    ",25).."&lt;gold&gt;"..zData.db.localDB[thisRow].maya.."  &lt;ansiMagenta&gt;Maya Figurine")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits5.."  ",3).." &lt;ansiMagenta&gt;32x "..string.cut("World Shattering                    ",25))
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].crits6.."  ",3).." &lt;ansiMagenta&gt;64x "..string.cut("Plane Razing                    ",25))
  cecho("hunterDisplay","\n")   
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].gold.." &lt;ansiMagenta&gt; : Total Gold Gained")
  cecho("hunterDisplay","\n &lt;gold&gt;"..string.cut((zData.db.localDB[thisRow].gpm),5).."&lt;ansiMagenta&gt; : Gold Gained Per Minute")
  cecho("hunterDisplay","\n") 
-------------------------- Breakdown the killList string into a table for display
  local tempTable = string.split(zData.db.localDB[thisRow].killlist, "| ")
  local tempKillTable = {}
  for k, v in pairs(tempTable) do
    if tempKillTable[v] then 
      tempKillTable[v] = tempKillTable[v] + 1
    else
      tempKillTable[v] = 1
    end
  end   
  cecho("hunterDisplay","\n &lt;gold&gt;"..zData.db.localDB[thisRow].kill.." &lt;purple&gt;Kills at &lt;gold&gt;"..string.cut(zData.db.localDB[thisRow].kpm,5).."&lt;purple&gt; Kills Per Minute")
  for k, v in spairs(tempKillTable) do
    if v&gt;9 then
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut(" ",1).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..k)
    else
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut("  ",2).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..k)
    end
  end
  cecho("hunterDisplay","\n") 
-------------------------- Breakdown the long taliList string into a table for display
  cecho("hunterDisplay","\n &lt;purple&gt;Total Talismans: &lt;gold&gt;"..zData.db.localDB[thisRow].tali)
  if tonumber(zData.db.localDB[thisRow].tali) &gt; 0 then
  tempTable = string.split(zData.db.localDB[thisRow].talilist, "| ") 
  local tempTaliTable = {}
  for k, v in pairs(tempTable) do
    if tempTaliTable[v] then 
      tempTaliTable[v] = tempTaliTable[v] + 1
    else
      tempTaliTable[v] = 1
    end
  end   
  for k, v in spairs(tempTaliTable) do 
    if v&gt;9 then
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut(" ",1).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..string.gsub(k, ":", "&lt;purple&gt;:"))
    else
      cecho("hunterDisplay","\n  &lt;purple&gt;\["..string.cut("  ",2).."&lt;gold&gt;"..string.cut(v.." ",3).."&lt;purple&gt;\]  &lt;ansiMagenta&gt;"..string.gsub(k, ":", "&lt;purple&gt;:"))
    end
  end 
  end
-------------------------- Display Footer  
  cecho("hunterDisplay","\n")
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@"))
  cechoLink("hunterDisplay", "\n                                    Click Here For zBash Chart                               ", [[zData.db.showData("kpm")]], [[]], true)
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@"))
end 


-------------------------------------------------
--                                             --
--  Delete a saved record:                     --
--               zData.db.clickbackdelete()    --
--                                             --
-------------------------------------------------
function zData.db.clickbackdelete(thisRow)
  db:delete(zData.db.expdb.zones, zData.db.localDB[thisRow]._row_id)
  clearWindow("hunterDisplay") 
  hecho("hunterDisplay", rainbow("\n\n\n\n@@#############################################################################################@@"))  
  cecho("hunterDisplay","\n&lt;red&gt;                                     --@@ DELETED ENTRY @@--  ")
  hecho("hunterDisplay", rainbow("\n@@#############################################################################################@@\n")) 
  cechoLink("hunterDisplay", "                                    Click Here For zBash Chart                               ", [[zData.db.showData("kpm")]], [[]], true)
  hecho("hunterDisplay", rainbow("\n      @@#################################################################################@@\n"))
end


</script>
				<eventHandlerList />
			</Script>
			<Script isActive="yes" isFolder="no">
				<name>movement</name>
				<packageName></packageName>
				<script>-------------------------------------------------
--                                             --
--               zData.movement()              --
--  This Function Runs Everytime Room Updates  --
--                                             --
-------------------------------------------------
function zData.movement() 
-----------------------------------------------------------------------------------------------
-- Update Area    
  if gmcp.Room.Info.area ~= zData.char.lastArea then  -------------&lt;--&lt;--&lt; Zone Change Detected

-----------------------------------------------------------------------------------------------
-- Collect experience percent from gmcp, check old xp (zData.char.oxp)
    if string.match(gmcp.Char.Status.xp, "%d+.%d+") then
      zData.char.xp = tonumber(string.match(gmcp.Char.Status.xp, "%d+.%d+"))
    elseif string.match(gmcp.Char.Status.xp, "%d+") then
      zData.char.xp = tonumber(string.match(gmcp.Char.Status.xp, "%d+"))
    end
    if zData.char.oxp == 0 then zData.char.oxp = zData.char.xp end

-----------------------------------------------------------------------------------------------
-- If your exp is not = to your old exp AND you have been in a zone FOR MORE &gt; THAN 60 SECONDS
    if (zData.char.oxp ~= zData.char.xp or zData.char.killsCount &gt; 0) and getStopWatchTime("zoneHuntWatch") &gt; 60 then
      stopStopWatch("zoneHuntWatch")  

-----------------------------------------------------------------------------------------------
-- Update zData.Character Variables used for saving to the Database
      zData.char.tempTime = getStopWatchTime("zoneHuntWatch")
      zData.char.minuteTime = zData.char.tempTime/60
      zData.char.xpGains = zData.char.xp-zData.char.oxp
      zData.char.xpGainsMin = zData.char.xpGains/zData.char.minuteTime
      zData.char.killsPerMinute = zData.char.killsCount/zData.char.minuteTime
      zData.char.gpm = zData.char.gold/zData.char.minuteTime

-----------------------------------------------------------------------------------------------
-- Convert tables to strings for the database (will turn back to tables when pulled)
      zData.char.killListString = nil
      if #zData.char.killList &gt; 0 then
        zData.char.killListString = table.concat(zData.char.killList, "| ")
      end
      zData.char.taliListString = nil
      if #zData.char.taliList &gt; 0 then
        zData.char.taliListString = table.concat(zData.char.taliList, "| ")
      end

-----------------------------------------------------------------------------------------------
-- Record when this happened with getTime(use string)
      zData.char.when = getTime(true)
            
-----------------------------------------------------------------------------------------------
-- Send All information to database   
      zData.db.zoneAdd(
        zData.char.lastArea,
        gmcp.Char.Status.class, 
        zData.defs.exp, 
        zData.defs.crit, 
        zData.char.tempTime, 
        zData.char.xpGainsMin, 
        zData.char.xpGains, 
        zData.char.killsCount, 
        zData.char.killsPerMinute, 
        zData.char.gold, 
        zData.char.gpm, 
        zData.char.str, 
        zData.char.dex, 
        zData.char.int, 
        zData.char.con, 
        zData.char.totalAttacks, 
        zData.char.crithits, zData.char.crit1, zData.char.crit2, zData.char.crit3, zData.char.crit4, zData.char.crit5, zData.char.crit6, 
        zData.char.shield, 
        zData.char.paragon, 
        zData.char.searedglyph, 
        zData.char.mayafigure, 
        zData.char.taliCount, 
        zData.char.killListString, 
        zData.char.taliListString,
        zData.char.when
        )
    end

-----------------------------------------------------------------------------------------------
-- Reset all saved data for next area
    zData.char = {
      lastArea = gmcp.Room.Info.area,
      tempTime = 0,
      minuteTime = 0,
      xpGains = 0,
      xpGainsMin = 0,
      killsPerMinute = 0, 
      killsCount = 0,
      taliCount = 0,
      ogold = gmcp.Char.Status.gold,
      gold = 0,
      gpm = 0,
      totalAttacks = 0,
      crithits = 0,
      crit1 = 0,
      crit2 = 0,
      crit3 = 0,
      crit4 = 0,
      crit5 = 0,
      crit6 = 0,
      searedglyph = 0,
      shield = 0,
      paragon = 0,
      mayafigure = 0,     
      killList = {},
      taliList = {},
      when= 0,
    }

-----------------------------------------------------------------------------------------------
-- Save OLD experience for new zone    
    if string.match(gmcp.Char.Status.xp, "%d+.%d+") then
      zData.char.oxp = tonumber(string.match(gmcp.Char.Status.xp, "%d+.%d+"))
    elseif string.match(gmcp.Char.Status.xp, "%d+") then
      zData.char.oxp = tonumber(string.match(gmcp.Char.Status.xp, "%d+"))
    end

-----------------------------------------------------------------------------------------------
-- Reset and Start Stopwatch for this zone (always running / only resets here on zone change)
    resetStopWatch("zoneHuntWatch")
    startStopWatch("zoneHuntWatch") 
	end  
end
-----------------------------------------------------------------------------------------------
registerAnonymousEventHandler("gmcp.Room.Info", "zData.movement") ---&lt;--&lt; Run When Room Updates
-----------------------------------------------------------------------------------------------</script>
				<eventHandlerList />
			</Script>
			<Script isActive="yes" isFolder="no">
				<name>Rainbow Script</name>
				<packageName></packageName>
				<script>-- Take in a string to rainbow-ify, optionally rainbow type and frequency for type 1
-- str   : string to rainbow-ify
-- type  : type of rainbow-ification
--         0 - single cycle of colours, default option
--         1 - multiple cycles determined by frequency, possible less than a full cycle
--         2 - Old, ugly, technically rainbowed thing
-- freq  : color frequency of rainbow in degrees, 0 to 360, default 15
--         higher freqs produce much shorter cycles of color, lower freqs longer cycles
--         freq of 1 is solid color
-- Return: returns a string suitable for plugging into hecho, colored in the rainbow
--         style chosen
function rainbow(str, type, freq)
	-- default settings, set to default if out-of-bounds
	type = type or 0
	if type &gt; 2 or type &lt; 0 then type = 0 end

	freq = freq or 15

	if freq &lt; 0 or freq &gt; 360 then freq = 15 end

	local product = ""
	local phase = 2 * math.pi / 3

	local rand = betterRand()


	if type == 0 then -- Non-repeating rainbow
		freq = 2*math.pi / #str
		for i = 1, #str do
			if string.sub(str, i, i) == " " then
				product = product..string.sub(str, i, i)
			else
				r = math.sin(freq*i + phase + rand*10) * 127 + 128
				g = math.sin(freq*i + 0 + rand*10) * 127 + 128
				b = math.sin(freq*i + 2*phase + rand*10) * 127 + 128
				r = string.format("%x", r)
				g = string.format("%x", g)
				b = string.format("%x", b)

				if #r &lt; 2 then r = "0"..r end
				if #g &lt; 2 then g = "0"..g end
				if #b &lt; 2 then b = "0"..b end
				product = product.."|c"..r..g..b..string.sub(str, i, i)
			end
		end
	elseif type == 1 then -- Repeating rainbow

		freq = freq * math.pi / 180
		for i = 1, #str do
			--if string.sub(str, i, i) == " " then
			--	product = product..string.sub(str, i, i)
			--else
				r = math.sin(freq*i + phase + rand*10) * 127 + 128
				g = math.sin(freq*i + 0 + rand*10) * 127 + 128
				b = math.sin(freq*i + 2*phase + rand*10) * 127 + 128
				r = string.format("%x", r)
				g = string.format("%x", g)
				b = string.format("%x", b)

				if #r &lt; 2 then r = "0"..r end
				if #g &lt; 2 then g = "0"..g end
				if #b &lt; 2 then b = "0"..b end
				product = product.."|c"..r..g..b..string.sub(str, i, i)
			--end
		end
	elseif type == 2 then -- Old, uglier rainbow
		local colours = { "|cFF0000", "|cFF6600", "|cFFEE00", "|c00FF00", "|c0099FF", "|c4400FF", "|c9900FF" }
		local pass = math.random(7)

		for char in str:gmatch"." do
			--if char == " " then
			--	product = product .. char
			--else
				product = product .. colours[pass] .. char
				if pass == #colours then pass = 1 end
					pass = pass + 1
			--end
		end
	end
	return product.."|r"
end
 
function betterRand()
	randomtable = {}
	for i = 1, 97 do
		randomtable[i] = math.random()
	end
	local x = math.random()
	local i = 1 + math.floor(97*x)
	x, randomtable[i] = randomtable[i], x
	return x
end</script>
				<eventHandlerList />
			</Script>
			<Script isActive="yes" isFolder="no">
				<name>buildHunter</name>
				<packageName></packageName>
				<script>function zData.buildHunter()
  zData.hunter = {}

  --Create the hunter Adjustable
  zData.hunter.window = Adjustable.Container:new({
    name = "zgui.hunter.window",
    x = 0, y = 0,
    width = "50%",
    height = "50%",  
    adjLabelstyle = "background-color:rgba(0,40,100,100%); border: 5px inset purple;",
    buttonstyle=[[
      QLabel{ border-radius: 5px; background-color: rgba(140,140,140,100%);}
      QLabel::hover{ background-color: rgba(160,160,160,50%);}
    ]],
    buttonFontSize = 10,
    buttonsize = 15,          
  },main)

  --Create the hunter container
  zData.hunter.container = Geyser.Container:new({
    name = "zData.hunter.back",
    x = 0, y = 0,
    width = "100%",
    height = "100%",        
  },zData.hunter.window)  

  --Create the hunter Console
  zData.hunter.console = Geyser.MiniConsole:new({
    name = "hunterDisplay",
    x = 0, y = 0,
    autoWrap = false,
    width = "100%",
    height = "100%",
    color="black",
    --scrollBar = true,
  },zData.hunter.container) 

  setFontSize("hunterDisplay", 9)
  zData.hunter.window:setTitle("Hunting Scrolls","gray")
  zData.hunter.window:show()

end</script>
				<eventHandlerList />
			</Script>
		</ScriptGroup>
	</ScriptPackage>
</MudletPackage>
